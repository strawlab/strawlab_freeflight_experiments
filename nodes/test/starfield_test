#!/usr/bin/env python
import numpy as np
import sys

# ROS imports ############################
import roslib; roslib.load_manifest('strawlab_freeflight_experiments')
import rospy
from std_msgs.msg import Float32
from geometry_msgs.msg import Vector3

import flyvr.display_client as display_client
from strawlab_freeflight_experiments.topics import TOPIC_STAR_VELOCITY, \
     TOPIC_STAR_ROTATION_RATE, TOPIC_STAR_SIZE

class Node(object):
    def __init__(self):
        rospy.init_node("starfield_test")
        self.pub_star_velocity = rospy.Publisher(TOPIC_STAR_VELOCITY, Vector3)
        self.pub_star_rotation_rate = rospy.Publisher(TOPIC_STAR_ROTATION_RATE, Float32)
        self.pub_star_size = rospy.Publisher(TOPIC_STAR_SIZE, Float32)

    def run(self):
        r = rospy.Rate(200) # 200hz
        while not rospy.is_shutdown():
            #self.step()
            t = rospy.get_time()
            msg = Vector3()
            msg.x = 0
            msg.y = 0
            msg.z = np.sin(2*np.pi*t)
            self.pub_star_velocity.publish(msg)
            self.pub_star_rotation_rate.publish( Float32( 1.0) )
            self.pub_star_size.publish( Float32( 50*(np.sin(2*np.pi*t/10.0)+1) ))
            r.sleep()

def main():
    node = Node()
    return node.run()

if __name__=='__main__':
    main()
