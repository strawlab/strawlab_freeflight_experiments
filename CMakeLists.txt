cmake_minimum_required(VERSION 2.4.6)
set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake/Modules/")
set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake/Modules/cuda")

SET(CUDA_TOOLKIT_ROOT "/usr/local/cuda")
FIND_PACKAGE(OsgCompute)
INCLUDE(FindCuda)

#set the default path for built executables to the "bin" directory
set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)
#set the default path for built libraries to the "lib" directory
set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)

FIND_PACKAGE(OpenThreads)
FIND_PACKAGE(osg)
FIND_PACKAGE(osgUtil)
FIND_PACKAGE(osgDB)
FIND_PACKAGE(osgText)
FIND_PACKAGE(osgParticle)
FIND_PACKAGE(osgTerrain)
FIND_PACKAGE(osgViewer)
FIND_PACKAGE(osgGA)
FIND_PACKAGE(osgWidget)
FIND_PACKAGE(osgParticle)

SET(OSG_LIBS ${OPENTHREADS_LIBRARIES} ${OSG_LIBRARIES} ${OSGVIEWER_LIBRARIES} ${OSGGA_LIBRARIES} ${OSGDB_LIBRARIES} ${OSGWIDGET_LIBRARIES} ${OSGUTIL_LIBRARIES} ${OSGTEXT_LIBRARIES} ${OSGPARTICLE_LIBRARIES})

SET(POCO_FIND_REQUIRED 1)
FIND_PACKAGE(Poco)

SET(JANSSON_FIND_REQUIRED 1)
FIND_PACKAGE(jansson)

SET(VROS_DISPLAY_PATH "../vros/vros_display")
SET(VROS_DISPLAY_INCLUDE_PATH "${VROS_DISPLAY_PATH}/include")

FIND_LIBRARY(VROS_DISPLAY_LIBRARY
	NAMES vros_display
	PATHS "${VROS_DISPLAY_PATH}/lib")

IF (VROS_DISPLAY_LIBRARY)
  MESSAGE(STATUS "Found vros_display: ${VROS_DISPLAY_LIBRARY}")
ELSE(VROS_DISPLAY_LIBRARY)
  MESSAGE(FATAL_ERROR "Could not find vros_display library")
ENDIF(VROS_DISPLAY_LIBRARY)

SET(BOOST_LIBRARY_PATHS "/usr/lib")

FIND_LIBRARY(BOOST_SYSTEM_LIBRARY
  NAMES boost_system
  PATHS BOOST_LIBRARY_PATHS)

FIND_LIBRARY(BOOST_FILESYSTEM_LIBRARY
  NAMES boost_filesystem
  PATHS BOOST_LIBRARY_PATHS)

add_library(StimulusAltitudeEdge SHARED src/StimulusAltitudeEdge.cpp)
target_link_libraries(StimulusAltitudeEdge ${OSG_LIBS} ${POCO_LIBRARIES}
  ${JANSSON_LIBRARIES} ${BOOST_SYSTEM_LIBRARY} ${BOOST_FILESYSTEM_LIBRARY}
  ${VROS_DISPLAY_LIBRARY})

add_library(StimulusOSGFile SHARED src/StimulusOSGFile.cpp)
target_link_libraries(StimulusOSGFile ${OSG_LIBS} ${POCO_LIBRARIES}
  ${JANSSON_LIBRARIES} ${BOOST_SYSTEM_LIBRARY} ${BOOST_FILESYSTEM_LIBRARY}
  ${VROS_DISPLAY_LIBRARY})

add_library(StimulusStarField SHARED src/StimulusStarField.cpp)
target_link_libraries(StimulusStarField ${OSG_LIBS} ${POCO_LIBRARIES}
  ${JANSSON_LIBRARIES}  ${BOOST_SYSTEM_LIBRARY} ${BOOST_FILESYSTEM_LIBRARY}
  ${VROS_DISPLAY_LIBRARY})

add_library(StimulusStarFieldAndModel SHARED src/StimulusStarFieldAndModel.cpp)
target_link_libraries(StimulusStarFieldAndModel ${OSG_LIBS} ${POCO_LIBRARIES}
  ${JANSSON_LIBRARIES}  ${BOOST_SYSTEM_LIBRARY} ${BOOST_FILESYSTEM_LIBRARY}
  ${VROS_DISPLAY_LIBRARY})

SET(MY_CUDA_SOURCE_FILES
	src/PtclKernels.cu
)

SET(CUDA_NVCC_FLAGS "--compiler-options '-fPIC'")

# Use the CUDA_COMPILE macro.
CUDA_COMPILE( CUDA_FILES ${MY_CUDA_SOURCE_FILES} )

# collect the sources
SET(TARGET_SRC
	src/StimulusCUDAStarFieldAndModel.cpp
    ${CUDA_FILES}
)

MESSAGE(STATUS "TARGET_SRC: ${TARGET_SRC}")
MESSAGE(STATUS "CUDA_FILES: ${CUDA_FILES}")

add_library(StimulusCUDAStarFieldAndModel SHARED ${TARGET_SRC})
INCLUDE_DIRECTORIES(
  ${OSG_COMPUTE_INCLUDE_PATHS}
  ${CUDA_TOOLKIT_INCLUDE}
  ${VROS_DISPLAY_INCLUDE_PATH}
  )
target_link_libraries(StimulusCUDAStarFieldAndModel
  ${OSG_LIBS} ${POCO_LIBRARIES} ${JANSSON_LIBRARIES} ${OSG_COMPUTE_LIBRARIES}
  ${VROS_DISPLAY_LIBRARY})
